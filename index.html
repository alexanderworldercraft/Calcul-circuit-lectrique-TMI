<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Calculateur de circuits</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    h1 { color: #333; }
    .section { margin-bottom: 20px; }
    label, input, button { margin: 5px; }
    input { width: 80px; }
    .results { margin-top: 20px; background: #fff; padding: 10px; border: 1px solid #ccc; }
    .parallel-group { margin-bottom: 10px; border: 1px solid #ccc; padding: 10px; }
  </style>
</head>
<body>

  <h1>üßÆ Calculateur de circuits √©lectriques</h1>

  <div class="section">
    <label>Tension U (Volts) :</label>
    <input type="number" id="tension" placeholder="ex: 24">
  </div>

  <div class="section">
    <h2>üîó R√©sistances en s√©rie</h2>
    <div id="serieInputs"></div>
    <button onclick="addResistance('serie')">+ Ajouter r√©sistance s√©rie</button>
  </div>

  <div class="section">
    <h2>‚õìÔ∏è Zones en parall√®le</h2>
    <div id="parallelGroups">
      <div class="parallel-group" id="group1">
        <h3>Groupe 1</h3>
        <div id="paralleleInputs1"></div>
        <button onclick="addResistance('parallele', 1)">+ Ajouter r√©sistance parall√®le</button>
      </div>
    </div>
    <button onclick="addParallelGroup()">+ Ajouter un autre groupe parall√®le</button>
  </div>

  <div class="section">
    <button onclick="calculer()">‚ö° Calculer</button>
    <button onclick="reset()">üîÑ R√©initialiser</button>
  </div>

  <div class="results" id="resultats"></div>

<script>
  // Ajout de champs dynamiques pour les r√©sistances
  function addResistance(type, groupId = 0) {
    const container = groupId > 0 
      ? document.getElementById('paralleleInputs' + groupId)
      : document.getElementById('serieInputs');
    const input = document.createElement('input');
    input.type = 'number';
    input.placeholder = 'R en Œ©';
    input.className = type;
    container.appendChild(input);
  }

  // Ajout d'un groupe parall√®le
  function addParallelGroup() {
    const groupCount = document.querySelectorAll('.parallel-group').length + 1;
    const groupDiv = document.createElement('div');
    groupDiv.className = 'parallel-group';
    groupDiv.id = 'group' + groupCount;
    groupDiv.innerHTML = `
      <h3>Groupe ${groupCount}</h3>
      <div id="paralleleInputs${groupCount}"></div>
      <button onclick="addResistance('parallele', ${groupCount})">+ Ajouter r√©sistance parall√®le</button>
    `;
    document.getElementById('parallelGroups').appendChild(groupDiv);
  }

  // Fonction de calcul
function calculer() {
  const U = parseFloat(document.getElementById('tension').value) || 0;

  const Rs = [...document.querySelectorAll('.serie')].map(el => parseFloat(el.value)).filter(v => !isNaN(v));
  const ReqSerie = Rs.reduce((acc, val) => acc + val, 0);

  const parallelGroups = document.querySelectorAll('.parallel-group');
  let totalParallelResistance = 0;
  let I_total = 0;
  let Us_serie = [];

  let U_restant = U;
  let groupsDetails = '';
  let svgParts = ['<svg width="100%" height="200" xmlns="http://www.w3.org/2000/svg">'];

  // Tension
  svgParts.push(`<rect x="10" y="80" width="30" height="40" fill="lightblue"/><text x="15" y="100" font-size="12">U</text>`);

  let x = 50;

  // R√©sistances s√©rie
  if (Rs.length) {
    Us_serie = Rs.map(R => {
      const u = (U / (ReqSerie + 1)).toFixed(2);
      return u;
    });

    Rs.forEach((R, i) => {
      const u = Us_serie[i];
      const iVal = (U / (ReqSerie + 1)).toFixed(2);
      const p = (u * iVal).toFixed(2);
    });
  }

  // Calcule la vraie I_total apr√®s avoir Req complet
  parallelGroups.forEach((group, idx) => {
    const Rp = [...group.querySelectorAll('.parallele')].map(el => parseFloat(el.value)).filter(v => !isNaN(v));
    if (Rp.length) {
      const ReqParallele = 1 / Rp.reduce((acc, val) => acc + (1 / val), 0);
      totalParallelResistance += ReqParallele;
    }
  });

  const ReqTotal = ReqSerie + totalParallelResistance;
  I_total = ReqTotal > 0 ? (U / ReqTotal) : 0;
  Us_serie = Rs.map(R => (I_total * R).toFixed(2));
  U_restant = Rs.length > 0 ? (U - Us_serie.reduce((acc, val) => acc + parseFloat(val), 0)).toFixed(2) : U;

  // Groupes en parall√®le
  parallelGroups.forEach((group, idx) => {
    const Rp = [...group.querySelectorAll('.parallele')].map(el => parseFloat(el.value)).filter(v => !isNaN(v));
    if (!Rp.length) return;

    const ReqParallele = 1 / Rp.reduce((acc, val) => acc + (1 / val), 0);

    groupsDetails += `<p><strong>Groupe ${idx + 1} en parall√®le :</strong> (Req = ${ReqParallele.toFixed(2)} Œ©)</p><ul>`;
    svgParts.push(`<line x1="${x}" y1="100" x2="${x + 100}" y2="50" stroke="black"/>`);
    svgParts.push(`<line x1="${x}" y1="100" x2="${x + 100}" y2="150" stroke="black"/>`);

    Rp.forEach((R, i) => {
      const I = (U_restant / R).toFixed(2);
      const P = (I * U_restant).toFixed(2);

      groupsDetails += `<li>R${i + 1} = ${R} Œ© ‚Üí U = ${U_restant} V, I = ${I} A, P = ${P} W</li>`;
      svgParts.push(`<rect x="${x + 100}" y="${60 + (i * 40)}" width="30" height="30" fill="lightgreen"/>
                     <text x="${x + 105}" y="${80 + (i * 40)}" font-size="12">R${i + 1}</text>`);
    });
    groupsDetails += `</ul>`;
    x += 150;
  });

  const P_total = (U * I_total).toFixed(2);
  svgParts.push(`<line x1="${x}" y1="100" x2="${x + 40}" y2="100" stroke="black"/>`);
  svgParts.push(`</svg>`);

  document.getElementById('resultats').innerHTML = `
    <p><strong>R√©sistance √©quivalente totale :</strong> ${ReqTotal.toFixed(2)} Œ©</p>
    <p><strong>Courant total :</strong> ${I_total.toFixed(2)} A</p>
    <p><strong>Puissance totale :</strong> ${P_total} W</p>

    ${Rs.length ? `
      <p><strong>R√©sistances en s√©rie :</strong></p>
      <ul>
        ${Rs.map((R, i) => {
          const u = Us_serie[i];
          const p = (u * I_total).toFixed(2);
          return `<li>R${i + 1} = ${R} Œ© ‚Üí U = ${u} V, I = ${I_total.toFixed(2)} A, P = ${p} W</li>`;
        }).join('')}
      </ul>
    ` : ''}

    ${groupsDetails}
    <h3>üß∞ Sch√©ma du circuit</h3>
    ${svgParts.join('')}
  `;
}

  // Fonction pour r√©initialiser tous les champs
  function reset() {
    // R√©initialisation des champs de tension et r√©sistances
    document.getElementById('tension').value = '';
    document.getElementById('serieInputs').innerHTML = '';
    document.getElementById('parallelGroups').innerHTML = `
      <div class="parallel-group" id="group1">
        <h3>Groupe 1</h3>
        <div id="paralleleInputs1"></div>
        <button onclick="addResistance('parallele', 1)">+ Ajouter r√©sistance parall√®le</button>
      </div>
    `;
    // R√©initialisation des r√©sultats
    document.getElementById('resultats').innerHTML = '';
  }
</script>

</body>
</html>
